---
title: 移动线下购卡实名API 
tags: api
---

# 域名 
` http://wap.gd.10086.cn`

# ctxPath {#ctxpath}
`http://wap.gd.10086.cn/nwap'`


## 获取号码列表


### 请求 URL
`http://wap.gd.10086.cn/nwap/card/cardSearch/cardlist.jsps`

### 请求方法
`POST`

### 请求参数

参数名 | 描述  | 示例值
 :------: | :------:  | :------:
city | 城市 | 755
opCode | 卡类型 | 4：0元副卡<br>7：全球通预约<br>10：校园赠卡<br>12：移动王卡<br>22：流量卡
pageNo | 页码 | 1
pageSize | 每页数量 | 10
offLine | 线下实名（固定值 1） | 1
city | 城市 | 755
hzhbjr | 合作伙伴接入 | BBSZ0HC16110710 
recoempltel | 回收 | Bhsckj 


## Response
```html
	<tr>
	    <td>147<i></i>0669<i></i><span class="text_red">9625</span></td>
	    <td>深圳</td>
	    <td>移动王卡</td>
	    <td><a href="/nwap/card/cardDetail/doCardDetail.jsps?cardPackSid=CARD_PACK-20181105051720960-10908819" class="numberpaybtn" otitle="首页-购买_14706699625" otype="button">购买</a></td>
		<td><a onclick="dmlCollect(this,'14706699625','深圳','移动王卡','25','0','CARD_PACK-20181105051720960-10908819');" class="numberpaybtn red" otitle="首页-加入收藏_14706699625" otype="button" val='14706699625'>收藏</a></td>
	</tr>
	<script type="text/javascript">
		if(getCookieStatic('cartItem')!=null){
			if(getCookieStatic('cartItem').indexOf(14706699625)!=-1){
				var cartItem=evalJSON('['+getCookieStatic('cartItem')+']');
				$('.numberpaybtn').each(function(index, el) {
					var mb = $(this).attr('val');
					for(var i in cartItem){  
						if (cartItem[i].num==mb) {
							$(this).addClass('dis');
						}
					}
	    		});
			}
		}
	</script>
```



## 2.检查号码状态

### 请求 URL
[ctxPath](#ctxpath)  +  `"/card/cardOrder/checkCardState.jsps"`

`http://wap.gd.10086.cn/nwap/card/cardOrder/checkCardState.jsps`

### 请求方法
`POST`

### 请求参数

参数名 | 描述  | 示例值
 :------: | :------:  | :------:
cardsid | 号码序列号(cardPackSid) | CARD_PACK-20181130054753487-37642862

### 检验返回结果

```flow
response=>start: 检验返回结果
next=>end: 号卡状态正常，可以进行下一步
opResponse=>operation: 判断是否有返回
opType=>operation: 判断 type == 'Exception'
opContent=>operation: 判断 content == true/false
opAttachment=>subroutine: 判断 attachment != null
opErrorCode0=>subroutine: 判断 attachment[0]['code'] == "0"
opErrorCode2=>subroutine: 判断 attachment[0]['code'] == "2"

condResponse=>condition: Yes or No?
condType=>condition: Yes or No?
condContent=>condition: Yes or No?
condAttachment=>condition: Yes or No?
condErrorCode0=>condition: Yes or No?
condErrorCode2=>condition: Yes or No?

cardError=>inputoutput: 查询号卡状态异常，请稍后重试！
code0Error=>inputoutput: 尊敬的客户，此号码已被其他用户预定，若该用户放弃购买，号码将在5分钟后释放，请稍后再试，或选择其他号码!
code2Error=>inputoutput: 尊敬的客户：您挑选的号码已售出，请抢购其他号码!
defaultErr=>inputoutput: 尊敬的客户：您挑选的号码已售出，请抢购其他号码！
systemErr=>inputoutput: 系统繁忙，请稍后再试!

response->opResponse->condResponse
condResponse(yes)->opType->condType
condResponse(no)->systemErr
condType(yes)->cardError
condType(no)->opContent->condContent
condContent(yes)->next
condContent(no)->opAttachment->condAttachment
condAttachment(yes)->opErrorCode0->condErrorCode0
condAttachment(no)->defaultErr
condErrorCode0(yes)->code0Error
condErrorCode0(no)->opErrorCode2->condErrorCode2
condErrorCode2(yes)->code2Error
condErrorCode2(no)->systemErr
```

### Response 返回数据格式

号卡正常返回

```json
{
	"content" : true,
	"type" : "undefinition"
}
```

号卡异常返回
```json
{
    "attachment": [
        {
            "name": "code",
            "value": 2
        }
    ],
    "content": false,
    "type": "undefinition"
}
```

## 3.组装预约采集验签url

### 请求 URL
[ctxPath](#ctxpath)  +  `"/card/cardDetail/getPreordainCheckUrl.jsps"`

`http://wap.gd.10086.cn/nwap/card/cardDetail/getPreordainCheckUrl.jsps`

### 请求方法
`POST`

### 请求参数

参数名 | 描述  | 示例值
:------: | :------:  | :------:
cardNum | 号码 | 15915342241
cardpacksid | 号码序列号 | CARD_PACK-20181130054753487-37642862
basePrivInfoId | 套餐 | prod.10086000010513
solutionId | 优惠 | 1782568406_15915342241
offLine | 线下实名（固定值 1） | 1

### 检验返回结果

```flow
response=>start: 检验返回结果
next=>end: 保存跳转链接 attachment[0].value，进行下一步操作
opResponse=>operation: 判断是否有返回
opContent=>operation: 判断 content == "success"
opContentError=>subroutine: 判断 content 是否含有 "error:"
opErrorMsg=>subroutine: 判断 errorMsg != null

condResponse=>condition: Yes or No?
condContent=>condition: Yes or No?
condContentError=>condition: Yes or No?
condErrorMsg=>condition: Yes or No?

showErr=>inputoutput: 提示 ErrorMsg 内容
defaultErr=>inputoutput: 实名认证跳转失败！
systemErr=>inputoutput: 系统繁忙，请稍后再试!

response->opResponse->condResponse
condResponse(yes)->opContent->condContent
condResponse(no)->systemErr
condContent(yes)->next
condContent(no)->opContentError->condContentError
condContentError(yes)->opErrorMsg->condErrorMsg
condErrorMsg(yes)->showErr
condErrorMsg(no)->defaultErr
```

### 返回数据格式

```json
{
    "attachment": [
    {
        "name": "url",
        "value": "https://smz.cmcc-cs.cn:30026/edcreg/saleCardMiniAppointment/signTheCheck?requestSource=200990&transactionID=20020181017163529564964&signature=akfGXL4Orol529zmjVFGY1XvIytQH3NyNJQ1FQ60c%2Fl5tppKLL0fc1uqpPJgeKVOrklhHXkG8S%2F%2FpEv4S8FwGIiA3mr9xmOjch3mqsUQbqk40csQAMiDO6zC2xqpmJi%2FrjZWE%2F07J1KU5v9%2B%2F6b6OzIvxeIjRJGuzylVuhscUWbhVvLKzd7KskYv8cR2CK9dmyB1F64uJT%2FqfJb2NUHTCwAZRC8qz%2FPzacFM2dYIEChLT9v%2BrSlhqkBv8C2VfGkQNaklska%2Fl5pvRtN2B6fvDNf1O60eHj%2Bx9cmsJUnmS9ar2zl08WExUBwLQ2j8lqYjO4IJdHwvCwKAI42M3P1jzg%3D%3D&billId=a95eece5d126292f4ed4229ae1222abb&channelId=d6f8f65b3e9e02ff&busiCode=PREORDAIN_CHECK"
    }],
    "content": "success",
    "type": "undefinition"
}
```


## 4.图片上传+OCR识别

>1. 提取【第三步】保存的链接【attachment[0].value】内的请求参数 paramsJson
2. 检验参数
	1. 判断是否选择相册文件，依据是 图片最后修改时间 与 当前时间的差距，2000毫秒
	2. 判断图片文件是否过大，不能超过15MB，即15 * 1024 * 1024 KB
	3. 判断照片格式是否不符，允许格式为 image/jpeg，image/jpg，image/bmp，image/png，image/x-ms-bmp
	4. 上传图片前，先将图片base64Encode，即转为base64字符串
 
### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/saleCardMiniAppointment/uploadOcrPic`

### 请求方法
`POST`

### 请求参数
> paramsJson 即URL提取出来的请求参数
参数名 | 描述  | 示例值
:------: | :------:  | :------:
provCode | paramsJson.provCode | 200
sourceCode | paramsJson.sourceCode | 200990
channelId | paramsJson.channelId | d6f8f65b3e9e02ff
transactionId | paramsJson.transactionId | 108520181112140833960086
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629
busiType | 人像照、国徽照的时候为固定值 33<br>正面照为paramsJson.busiTyp | 33
uploadType | 固定值 0 | 0 
picType | 图片类型<br>Z => 人像照<br>F => 国徽照<br>M => 正面照 | Z
fileData | base64Encode图片（长字符串） | data:image/jpeg;base64,/9j/4AAQS.....
fileLen | 图片base64Encode后的字符串长度 | 8974


### 返回数据格式

图片上传成功返回

`人像照`
```json
{
    "returnCode": "0000",
    "bean": {
        "iddocAddr": "安徽省天长市千秋新村三巷10号",
        "idNo": "341181198809150011",
        "iddocName": "苏海峰",
        "status": "0",
        "picType": "Z",
        "iddocGenCd": "男",
        "birthDate": "19880915",
        "ethnicNm": "汉",
        "picUrlZ": "PaFTP/edcf/WEBH5YY/temp/VIDEO_ACTIVATE/200990/20181112/108520181112140833960086_Z.jpg"
    },
    "beans": [],
    "returnMessage": "success"
}
```

`国徽照`
```json
// 国徽照返回的数据要验证身份证的有效期是否为空
{
	"returnCode": "0000",
	"bean": {
		"lssauth": "天长市公安局",
		"status": "0",
		"picType": "F",
		"picUrlF": "PcFTP/edcf/WEBH5YY/temp/VIDEO_ACTIVATE/200990/20181112/108520181112140833960086_F.jpg",
		"certValidExpdate": "2010.07.15-2020.07.15"
	},
	"beans": [],
	"returnMessage": "success"
}
```


`人脸正面照`
```json
{
	"returnCode": "0000",
	"bean": {
		"picUrl": "PcFTP/edcf/WEBH5YY/temp/VIDEO_ACTIVATE/200/20181112/108520181112140833960086_M.jpg"
	},
	"beans": [],
	"returnMessage": "success"
}
```

错误返回

`证件照图片识别失败`
```json
{
	"returnCode": "1001",
	"bean": {},
	"beans": [],
	"returnMessage": "识别失败，请重新上传"
}
```

## 5.身份证人像照验证

 
### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/saleCardMiniAppointment/verifyZ`

### 请求方法
`POST`

### 请求参数

> 1.paramsJson 即URL提取出来的请求参数
> 2.时间戳 timeKey，格式为hhmmss，例如当前15点44分30秒，参数值就是 154430
> 3.需要加密的参数，加密为方法：DES加密/解密
> 4.加密格式：Encrypt('加密字段'，固定字段"zyzx2fyZ"，'时间戳timeKey')
> 5.格式化的身份证日期，将身份证拆分为年月日，然后接入汉字，例如19970706 参数值就是'1997年07月06日'

参数名 | 描述  | 示例值
:------: | :------:  | :------:
provCode | paramsJson.provCode | 200
sourceCode | paramsJson.sourceCode | 200990
channelId | paramsJson.channelId | d6f8f65b3e9e02ff
transactionId | paramsJson.transactionId | 108520181112140833960086
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629
billId | paramsJson.billId | ad6bbfa944f336c7d443385c9215b1d5
busiType | 固定值 33 | 33
specialTime | 时间戳 | 154430
iddocName| 加密的身份证名 | 
idNo | 加密的身份证号码 | 
iddocAddr | 加密的身份证号码 | 
ethnicNm | 身份证民族 | 汉族
iddocGenCd | 身份证性别 | 男
birthDate | 格式化的身份证日期 | 1997年07月06日

### 返回数据格式
正常返回 （"returnCode" = "0000"）

```json
{
	"returnCode": "0000",
	"bean": {},
	"beans": [],
	"returnMessage": "正面图片查验正确!"
}
```

异常返回

returnCode 为 5555
或者
returnMessage 含有 '系统繁忙'，'SCRM-404'，'系统异常' 等字段

returnCode 为 5555 的时候弹窗提示	： 返回字段中的returnMessage
'系统繁忙'  的时候弹窗提示 		： 网络超时，请稍候重试
'SCRM-404' 的时候弹窗提示 		： 系统繁忙，请稍候重试
'系统异常'  的时候弹窗提示 		： 返回字段中的returnMessage
以上情况都不存在的时候弹窗提示 	： 返回字段中的returnMessage

```json
{
	"returnCode": "1001",
	"bean": {},
	"beans": [],
	"returnMessage": "系统异常"
}
```

## 6.身份证国徽照验证

 > 1. 先检测身份证是否已过期
   1. 先判断是否为长期，判断依据是 字符串中是否含有 '长期'，含有则身份证有效
   2. 如果否，则判断是否已失效，判断依据是 失效日期 是否大于 当前日期

### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/saleCardMiniAppointment/verifyF`

### 请求方法
`POST`

### 请求参数

> paramsJson 即URL提取出来的请求参数

参数名 | 描述  | 示例值
:------: | :------:  | :------:
provCode | paramsJson.provCode | 200
sourceCode | paramsJson.sourceCode | 200990
channelId | paramsJson.channelId | d6f8f65b3e9e02ff
transactionId | paramsJson.transactionId | 108520181112140833960086
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629
billId | paramsJson.billId | ad6bbfa944f336c7d443385c9215b1d5
busiType | 固定值 33 | 33
lssauth | 签发机关(需要URLEncode) | 
certValiddate | 签发日期 | 
certExpdate | 失效日期 | 

### 返回数据格式

正常返回
```json
{
	"returnCode": "0000",
	"bean": {},
	"beans": [],
	"returnMessage": ""
}
```
异常返回

returnCode 为 5555
或者
returnMessage 含有 '系统繁忙'，'SCRM-404'，'系统异常' 等字段

returnCode 为 5555 的时候弹窗提示	： 返回字段中的returnMessage
'系统繁忙'  的时候弹窗提示 		： 网络超时，请稍候重试
'SCRM-404' 的时候弹窗提示 		： 系统繁忙，请稍候重试
'系统异常'  的时候弹窗提示 		： 返回字段中的returnMessage
以上情况都不存在的时候弹窗提示 	： 返回字段中的returnMessage

```json
{
	"returnCode": "1001",
	"bean": {},
	"beans": [],
	"returnMessage": "系统异常"
}
```


## 7.提交表单

### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/busiNoJump/checkStepApp`

### 请求方法
`POST`

### 请求参数

> paramsJson 即URL提取出来的请求参数

参数名 | 描述  | 示例值
:------: | :------:  | :------:
provCode | paramsJson.provCode | 200
sourceCode | paramsJson.sourceCode | 200990
channelId | paramsJson.channelId | d6f8f65b3e9e02ff
transactionId | paramsJson.transactionId | 108520181112140833960086
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629
billId | paramsJson.billId | ad6bbfa944f336c7d443385c9215b1d5
busiType | 固定值 33 | 33
jumpNum	 | 固定值 2 | 2


### 返回数据格式


## 8.真人照认证

>  检验参数
	1. 判断是否选择相册文件，依据是 图片最后修改时间 与 当前时间的差距，2000毫秒
	2. 判断图片文件是否过大，不能超过15MB，即15 * 1024 * 1024 KB
	3. 判断照片格式是否不符，允许格式为 image/jpeg，image/jpg，image/bmp，image/png，image/x-ms-bmp
	4. 上传图片前，先将图片base64Encode，即转为base64字符串

### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/saleCardMiniAppointment/verifyPicture`

### 请求方法
`POST`

### 请求参数

> paramsJson 即URL提取出来的请求参数

参数名 | 描述  | 示例值
:------: | :------:  | :------:
provCode | paramsJson.provCode | 200
sourceCode | paramsJson.sourceCode | 200990
channelId | paramsJson.channelId | d6f8f65b3e9e02ff
transactionId | paramsJson.transactionId | 108520181112140833960086
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629 || ''
busiType | 33 | 33
uploadType | 固定值 0 | 0 
picType | 固定值 M | M
fileData | base64Encode图片（长字符串） | data:image/jpeg;base64,/9j/4AAQS.....
fileLen | 图片base64Encode后的字符串长度 | 8974


### 返回数据格式

合格返回 （"returnCode" = "0000"）
```json
{
	"returnCode": "0000",
	"bean": {
		"callbackURL" : "",
		"isPopup" : ""
	},
	"beans": [],
	"returnMessage": "真人认证成功!"
}
```

错误返回
`真人照认证失败`
```json
{
	"returnCode": "2998",
	"bean": {},
	"beans": [],
	"returnMessage": "真人认证失败，请重新拍摄"
}
```


## 9.验证号码是否有效


### 请求 URL
`https://ebuy.gd.chinamobile.com/estorePortal/auth/mobile`

### 请求方法
`POST`

### 请求参数

> 检验参数
	如果 号码为空 或者 非纯数字 或者 长度不是11，弹窗提示 ： "请输入有效的手机号码"

参数名 | 描述  | 示例值
:------: | :------:  | :------:
mobile | 新购号码 | 14706991924

### 返回数据格式

```
返回验证：

rtcode {
	'0000'	=> '操作成功',
	'0001'	=> '操作失败',
	'0002'	=> '入参数据有误',
	'0003'	=> '没有权限',
	'0004'	=> '不能操作',
	'0005'	=> '执行资源不存在',
}

1.判断 rtcode
  A）rtcode == "0000"，协议状态正常，可以进行下一步
  B）rtcode != "0000"，弹窗提示 ： "目前系统繁忙，请您稍后再试。感谢您的谅解！"

2.判断 resultcode 
  A）resultcode == "success" ，号码正常，可以进行下一步操作，【验证号码订单信息】
  B）resultcode != "success" ，弹窗提示 ： "您输入的号码匹配不到订单信息，请您确认后重试。"
```

号码有效返回 （"returnCode" = "0000"）
```json
{
	"rs": [{
		"data": {
			"out": {
				"pojo": {
					"resultcode": "success"
					"result"	: "14706991924"
				}
			}
		},
		"ctl": {
			"rtcode": "0000"
		}
	}],
	"id": "0"
}
```

`号码无效返回`
```json
{
	"rs": [{
		"data": {
			"out": {
				"pojo": {
					"resultcode": "invalid_param"
				}
			}
		},
		"ctl": {
			"rtcode": "0000"
		}
	}],
	"id": "0"
}
```


## 10.验证号码订单信息


### 请求 URL
`https://ebuy.gd.chinamobile.com/estorePortal/auth`

### 请求方法
`POST`

### 请求参数

> 检验参数
	如果 号码为空 或者 非纯数字 或者 长度不是11，弹窗提示 ： "请输入有效的手机号码"

参数名 | 描述  | 示例值
:------: | :------:  | :------:
mobile | 新购号码 | 14706991924


### 返回数据格式

```
返回验证：

rtcode {
	'0000'	=> '操作成功',
	'0001'	=> '操作失败',
	'0002'	=> '入参数据有误',
	'0003'	=> '没有权限',
	'0004'	=> '不能操作',
	'0005'	=> '执行资源不存在',
}

1.判断 rtcode
	A）rtcode == "0000"，协议状态正常，可以进行下一步
	B）rtcode != "0000"，弹窗提示 ： "目前系统繁忙，请您稍后再试。感谢您的谅解！"

2.判断 resultcode 
	A）resultcode == "oldFlow" ，弹窗提示 ： "2018年9月1日前，购买号卡的用户，<a href=\"http://wap.gd.10086.cn/nwap/choseNumber/realName/index.jsps\">请点击这里</a>进行实名认证。"
  	B）resultcode != "success" ，弹窗提示 ： "您输入的号码匹配不到订单信息，请您确认后重试。"
	C）以上两种都不是，则该号码存在订单，可以进行下一步，【验证ICCID卡号】
```

`号码有订单返回`
```json
{
    "rs": [
        {
            "data": {
                "out": {
                    "pojo": {
                        "result": {
                        	"offline": 1
                        },
                        "resultcode": "success"
                    }
                }
            },
            "ctl": {
                "rtcode": "0000"
            }
        }
    ],
    "id": "0"
}
```

`号码无订单返回`
```json
{
    "rs": [
        {
            "data": {
                "out": {
                    "pojo": {
                        "resultnote": "号码格式不正确",
                        "resultcode": "invalidMobile"
                    }
                }
            },
            "ctl": {
                "rtcode": "0000"
            }
        }
    ],
    "id": "0"
}
```


## 11.验证ICCID卡号（白卡号）是否有效


### 请求 URL
`https://ebuy.gd.chinamobile.com/estorePortal/auth/iccid`

### 请求方法
`POST`

### 请求参数


> 参数验证
    1. 如果 ICCID卡号（白卡号）长度不是20，弹窗提示 ： {"title1": "信息有误", "title2": "请您填写有效的20位ICCID：", "title3": "您填写的ICCID卡号无效，您可以在自行线下购买的白SIM卡上找到20位ICCID卡号，请您检查后重新填写。"}
    2. 如果 身份证号码后四位长度不是4，弹窗提示 ： { "title1": "信息有误","title2": "您填写的身份证信息有误","title3": "请输入选号环节登记的身份证号后4位。"}


参数名 | 描述  | 示例值
:------: | :------:  | :------:
iccid | ICCID卡号（白卡号 | 89860000165464134895
serNo | 身份证号码后四位 | 2755

### 返回数据格式

```
返回验证：

rtcode {
	'0000'	=> '操作成功',
	'0001'	=> '操作失败',
	'0002'	=> '入参数据有误',
	'0003'	=> '没有权限',
	'0004'	=> '不能操作',
	'0005'	=> '执行资源不存在',
}

1.判断 rtcode
  A）rtcode == "0000"，协议状态正常，可以进行下一步
  B）rtcode != "0000"，弹窗提示 ： "目前系统繁忙，请您稍后再试。感谢您的谅解！"

2.判断 resultcode 
  A）resultcode == "success" ，ICCID卡号（白卡号）有效，可以进行下一步
  B）resultcode != "-100" ，弹窗提示 ： {"title1": "信息有误","title2": "请填写有效的ICCID","title3": "请填写有效的ICCID。"}
  C）resultcode != "14" ，弹窗提示 ： {"title1": "信息有误", "title2": "请您填写20位ICCID：", "title3": "您的订单是“线上选号、线下购卡”订单，请您填写自行线下购买的白SIM卡上的20位ICCID卡号。"}
  D）resultcode != "15" ，弹窗提示 ： {"title1": "信息有误", "title2": "请您填写有效的20位ICCID：", "title3": "您填写的ICCID卡号无效，您可以在自行线下购买的白SIM卡上找到20位ICCID卡号，请您检查后重新填写。"}
  E）resultcode != "16" ，弹窗提示 ： {"title1": "信息有误", "title2": "您填写的身份证信息有误：", "title3": "您填写的身份证信息与新购号码订单中的不一致，请您核实后重新填写。"}
  F）resultcode != "sessionTimeout" ，弹窗提示 ： {"title1": "系统繁忙","title2": "请您稍后再试：","title3": "会话已过期。"}
  G）以上都不是 ，弹窗提示 ： {"title1": "系统繁忙","title2": "请您稍后再试：","title3": "很抱歉，系统繁忙，请您稍后再试。"}

3.获取result内容,判断 status
  A）status == "1" || status == "11"，状态正常，可以进行下一步
  B）status == "3" || status == "14"，号卡已通过认证，弹窗提示 ： {"title1": "实名审核通过", "title2": "您的审核资料已通过：", "title3": "您的新购号码已通过实名审核，请您将白SIM卡插入手机后根据提示输入IMSI码激活白卡使用。"}
  C）以上都不是 ，根据offerCat+status获取弹窗内容
        
4.获取result内容,判断offerCat
  A）offerCat == "28" ，新购号码是万能副卡，需要捆绑主卡
  B）以上都不是 ，可以进行下一步，【设置密码】

```

`ICCID卡号（白卡号）有效返回`
```json
{
    "rs": [{
        "data": {
            "out": {
                "pojo": {
                    "result"    : {
                        "status"    : 1
                        "offerCat"  : "2"
                    },
                    "resultnote": null,
                    "resultcode": "success",
                }
            }
        },
        "ctl": {
            "rtcode": "0000"
        }
    }],
    "id": "0"
}
```

`ICCID卡号（白卡号）无效返回`
```json
{
    "rs": [{
        "data": {
            "out": {
                "pojo": {
                    "result": null,
                    "resultnote": "身份证号码不一致",
                    "resultcode": "16"
                }
            }
        },
        "ctl": {
            "rtcode": "0000"
        }
    }],
    "id": "0"
}
```


## 12.设置密码前需要获取订单信息，得到号码类型


### 请求 URL
`https://ebuy.gd.chinamobile.com/estorePortal/auth/detail`

### 请求方法
`POST`

### 请求参数

此接口不需要参数，是根据上一步【auth】步骤保存在服务器的session，储存了号码订单信息



### 返回数据格式

```
返回验证：

1.判断brand是否为全球通，即"brand" == "BrandGotone",是则终止操作，没有全球通
2.判断offerCat
  A）offerCat == "2" || offerCat == "14"，号码类型为神州行，限制密码长度为8
  B）offerCat == "28" ，号码类型为动感地带，限制密码长度为6

```

`访问会话有效返回`
```json
{
    "rs": [{
        "data": {
            "out": {
                "pojo": {
                    "offline": "1",
                    "serNo": "0011",
                    "mobile": "14706991924",
                    "offerCat": "2",
                    "resultcode": "0",
                    "brand": null
                }
            }
        },
        "ctl": {
            "rtcode": "0000"
        }
    }],
    "id": "0"
}
```

`访问会话无效返回`
```json
{
    "rs": [{
        "data": {
            "out": {
                "pojo": {
                    "result": "",
                    "resultnote": "会话已过期",
                    "resultcode": "1"
                }
            }
        },
        "ctl": {
            "rtcode": "0000"
        }
    }],
    "id": "0"
}
```


## 13.设置密码


### 请求 URL
`https://ebuy.gd.chinamobile.com/estorePortal/auth/setPassword`

### 请求方法
`POST`

### 请求参数


> 参数验证
    密码必须是纯数字密码，密码长度由前面【detail】接口返回的类型确定
    密码要有确认密码，两次输入密码要一致


参数名 | 描述  | 示例值
:------: | :------:  | :------:
newPassword | 新密码 | 12345678
oldPassword | 旧密码，前面【detail】接口返回的旧密码 | 12345678

### 返回数据格式

```
返回验证


rtcode {
    '0000'  => '操作成功',
    '0001'  => '操作失败',
    '0002'  => '入参数据有误',
    '0003'  => '没有权限',
    '0004'  => '不能操作',
    '0005'  => '执行资源不存在',
}

1.判断 rtcode
  A）rtcode == "0000"，协议状态正常，可以进行下一步
  B）rtcode != "0000"，弹窗提示 ： "目前系统繁忙，请您稍后再试。感谢您的谅解！"

2.判断 resultCode
  A）resultCode != "0"，状态异常
  B）resultCode == "0"，状态正常，可以进行下一步，【拍摄视频】

3.状态异常，再次判断resultCode
  A）resultCode == "100" , 弹窗提示：返回的"resultnote" + "，超过5次将会被锁定。"
  B）resultCode != "100" , 根据resultCode 和 message，得到错误信息弹窗内容

        message = {
            "981018": "号码状态异常，请您亲临我司营业厅办理业务。",
            "988010": "您的新密码只能是纯数字，请您修改后重试。",
            "100": "您当天密码验证错误已累积超过5次，请您明天再试！",
            "103": "您当天密码验证错误已累积超过5次，请您明天再试！",
            "104": "您的服务方式受限，请您亲临我司营业厅办理业务。",
            "102": "您的原密码为简单密码，请您亲临我司营业厅办理业务。",
            "1": "您的新密码属于弱密码，请您修改后重试。",
            "2": "您的新密码与当前服务密码相同，请您修改后重试。",
            "3": "密码长度不符合要求，神州行号码密码长度为8位，动感地带号码密码长度为6位，请您修改后重试。",
            "4": "目前系统异常，请您稍后再试。感谢您的谅解！",
            "5": "目前系统异常，请您稍后再试。感谢您的谅解！",
            "6": "号码状态异常，请您亲临我司营业厅办理业务。",
            "111": "目前系统异常，请您稍后再试。感谢您的谅解！",
            "error": "很抱歉，系统繁忙，请您稍后再试。",
            "sessionTimeout": "会话已过期。",
            "hasAuth": "您刚才已操作过视频审核，请您耐心等待一下审核结果。距离上次提交1分钟后，您方可重新提交。"
        };

```

`访问会话有效返回`
```json
{
    "rs": [{
        "data": {
            "out": {
                "pojo": {
                    "result": null,
                    "resultnote": "新密码与当前服务密码相同",
                    "resultcode": "2"
                }
            }
        },
        "ctl": {
            "rtcode": "0000",
            "uri": ""
        }
    }],
    "id": "0"
}
```

`访问会话无效返回`
```json
{
    "rs": [{
        "data": {
            "out": {
                "pojo": {
                    "resultcode": "sessionTimeout"
                }
            }
        },
        "ctl": {
            "rtcode": "0000",
            "rtnote": "会话已过期"
        }
    }],
    "id": "0"
}
```


## 14.获取随机验证码


### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/gdH5AppointmentActiveVideo/getReadCode`

### 请求方法
`POST`

### 请求参数

> paramsJson 即URL提取出来的请求参数

参数名 | 描述  | 示例值
:------: | :------:  | :------:
provCode | paramsJson.provCode | 200
sourceCode | paramsJson.sourceCode | 200990
transactionId | paramsJson.transactionId | 108520181112140833960086
provTransactionId | paramsJson.provTransactionId | 200201811131048156940742
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629 || ''
busiType | paramsJson.busiType | 21
channelId | 固定值 wechat | wechat
readLength | 固定值 4 | 4



### 返回数据格式

成功时返回 ("returnCode" = "0000")

```json
{
    "returnCode": "0000",
    "bean": {
        "readCode": "2860"
    },
    "beans": [],
    "returnMessage": "success"
}
```


## 15.校验接收结果的手机号

### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/gdH5AppointmentActiveVideo/getProvcodeByPhone`

### 请求方法
`POST`

### 请求参数


> paramsJson 即URL提取出来的请求参数

参数名 | 描述  | 示例值
:------: | :------:  | :------:
channelId | paramsJson.channelId | 
busiType | paramsJson.busiType | 21
transactionId | paramsJson.transactionId | 108520181112140833960086
provTransactionId | paramsJson.provTransactionId | 200201811131048156940742
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629 || ''
billId | 接收结果的手机号 | '13112104215'


### 返回数据格式

```
校验通过
returnCode == "0000" && provCode != "-99"
```

`成功时返回 "returnCode" = "0000" `
```json
{
    "returnCode": "0000",
    "bean": {
        "provCode": "200"
    },
    "beans": [],
    "returnMessage": "sucess"
}
```

`错误时返回`
```json
{
    "returnCode": "2999",
    "bean": {},
    "beans": [],
    "returnMessage": "根据手机号获取省份出错"
}
```


## 16.上传视频并认证

### 请求 URL
`https://smz.cmcc-cs.cn:30026/edcreg/gdH5AppointmentActiveVideo/verifyVideo`

### 请求方法
`POST`

### 请求参数

> paramsJson 即URL提取出来的请求参数

参数名 | 描述  | 示例值
:------: | :------:  | :------:
billId | paramsJson.billId | ad6bbfa944f336c7d443385c9215b1d5
provCode | paramsJson.provCode | 200
sourceCode | paramsJson.sourceCode | 200990
channelId | paramsJson.channelId | d6f8f65b3e9e02ff
busiType | paramsJson.busiType | 21
transactionId | paramsJson.transactionId | 108520181112140833960086
provTransactionId | paramsJson.provTransactionId | 200201811131048156940742
inputTransactionId | paramsJson.inputTransactionId | 20020181112140824386629 || ''
checkType | paramsJson.checkType | 
photoPath | paramsJson.photoPath | 
picNameRPath | paramsJson.picNameRPath | 
saleChannle | paramsJson.saleChannle | 
renOrVideo | 固定值 1 | 1
linkedPhone | 上一步接收结果的手机号 | 13112104215
file | 文件流 |
videoType | 视频格式mp4、mov、avi、flv、3gp、mpg、wmv、asf、asx |

### 返回数据格式

```
返回验证

1.判断 resultCode
  A）resultCode != "0"，认证不通过
     B）resultCode == "0"，认证通过，可以进行下一步

2.认证通过，判断 returnFlag
  A）returnFlag == "chongfu" ，弹窗提示 ： returnMessage
  B）returnFlag != "chongfu" ，认证通过，实名流程至此全部完成

3.认证不通过判断 isSysOrRgVerify
  A）isSysOrRgVerify == "0"，认证通过，实名流程至此全部完成
  B）以上情况都不是，弹窗提示 ： returnMessage
```

`成功时返回 "returnCode" = "0000" `
```json
{
    "returnCode": "0000",
    "bean": {
        "returnFlag": "",
        "isSysOrRgVerify": ""
    },
    "beans": [],
    "returnMessage": "sucess"
}
```

`错误时返回`
```json
{
    "returnCode": "2998",
    "bean": {},
    "beans": [],
    "returnMessage": "人证不一致，请重新录制"
}
```
